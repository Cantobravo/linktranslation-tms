SELECT
  p.project_id,
  p.project_name,
  CAST(p.project_rate  AS DECIMAL(10,2)) AS project_rate,
  CAST(p.project_total AS DECIMAL(10,2)) AS project_total,
  p.project_start_date,
  p.project_end_date
FROM projects p
JOIN customer_invoices ci
  ON ci.customer_invoice_id = {{ appsmith.store.invId }}
WHERE p.customer_id = ci.customer_id
  AND COALESCE(p.project_status, 'Not Invoiced') = 'Not Invoiced'
ORDER BY p.project_end_date DESC, p.project_id DESC;
