SELECT
  r.resource_id,
  r.resource_full_name,
  r.resource_email,
  ro.role_id,
  ro.role_name,
  COUNT(DISTINCT p.permission_id) AS perm_count,
  GROUP_CONCAT(DISTINCT p.permission_name ORDER BY p.permission_name SEPARATOR ', ') AS perm_list
FROM resources r
LEFT JOIN roles ro
  ON ro.role_id = r.role_id
LEFT JOIN role_permissions rp
  ON rp.role_id = ro.role_id
LEFT JOIN permissions p
  ON p.permission_id = rp.permission_id
WHERE COALESCE(r.resource_is_active, 1) = 1
  AND r.resource_status = 'Staff'
GROUP BY
  r.resource_id,
  r.resource_full_name,
  r.resource_email,
  ro.role_id,
  ro.role_name
ORDER BY r.resource_full_name;
